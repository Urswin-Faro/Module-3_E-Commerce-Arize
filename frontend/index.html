<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Arize | Home</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <!-- Bootstrap Icons CDN -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      defer
    ></script>
    <link href="../frontend/css/index.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>

  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">
          <img
            src="https://github.com/Urswin-Faro/Arive_assets/blob/main/Assets/imgs/arize.png?raw=true"
            alt=""
            class="img-fluid"
            style="max-width: 150px"
          />
        </a>
        <input id="checkbox" type="checkbox" />
        <label
          class="toggle"
          for="checkbox"
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <div id="bar1" class="bars"></div>
          <div id="bar2" class="bars"></div>
          <div id="bar3" class="bars"></div>

          <!-- <span class="navbar-toggler-icon"></span> -->
        </label>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a
                class="nav-link active"
                aria-current="page"
                href="../frontend/index.html"
                >Home</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../frontend/Html/products.html"
                >Products</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../frontend/Html/about.html"
                >About Us</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../frontend/Html/game.html"
                ><img
                  width="30"
                  height="30"
                  src="https://img.icons8.com/glyph-neue/64/FFFFFF/ps-controller.png"
                  alt="ps-controller"
              /></a>
            </li>
          </ul>
          <form class="d-flex" role="search" id="searchForm">
            <input
              class="form-control me-2"
              type="search"
              placeholder="Search"
              aria-label="Search"
              id="searchInput"
            />
            <button class="btn btn-outline-success" type="submit">
              Search
            </button>
          </form>

          <!-- Modal for displaying search results -->
          <div
            class="modal fade"
            id="searchResultsModal"
            tabindex="-1"
            aria-labelledby="searchResultsModalLabel"
            aria-hidden="true"
          >
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="searchResultsModalLabel">
                    Search Results
                  </h5>
                  <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                    aria-label="Close"
                  ></button>
                </div>
                <div
                  class="modal-body"
                  style="max-height: 200vh; overflow-y: auto"
                >
                  <div id="searchResultsContainer" class="row">
                    <!-- Dynamic product results will go here -->
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="logoutContainer">
            <!-- Login/Signup Button -->
            <button
              class="btn btn-button ms-2"
              data-bs-toggle="modal"
              data-bs-target="#authModal"
              btn
            >
              Log In
            </button>
            <p
              class="userName"
              style="display: none; justify-content: center"
            ></p>

            <button style="display: none" id="logoutButton">Logout</button>

            <button
              class="btn btn-button ms-2"
              data-bs-toggle="modal"
              data-bs-target="#authModal1"
              btn
            >
              Sign Up
            </button>
          </div>
          <!-- Cart Icon Button -->
          <button class="btn btn-button ms-2" id="cart-toggle">
            <i class="bi bi-cart"></i> Cart
          </button>
          <!-- cart dropdown -->
          <div class="cart-dropdown">
            <button class="close-button" onclick="closeCart()">X</button>

            <h2>Cart</h2>
            <p class="free-shipping">Free standard shipping</p>

            <!-- Scrollable Container for Cart Items -->
            <div class="scrollable-container">
              <div id="cart-items"></div>
            </div>

            <div id="cart-items"></div>

            <div class="cart-footer">
              <div class="total-section">
                <p>Subtotal: <span id="subtotal">R 0.00</span></p>
                <h1>Total: <span id="total">R 0.00</span></h1>
              </div>
              <a href="./Html/checkout.html">
                <button class="checkout-btn">Checkout</button>
              </a>
            </div>
          </div>
        </div>
      </div>
    </nav>
    <!-- Product Details Modal -->
    <div
      class="modal fade"
      id="productModal"
      tabindex="-1"
      aria-labelledby="productModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content shadow-lg rounded-3">
          <div class="modal-header bg-dark text-white">
            <h5 class="modal-title" id="productModalLabel">Product Details</h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="row g-4">
              <!-- Product Image Section -->
              <div class="col-md-5">
                <img
                  src=""
                  alt="Product Image"
                  class="img-fluid rounded-3 shadow-sm"
                />
              </div>

              <!-- Product Info Section -->
              <div class="col-md-7">
                <h4 id="productTitle" class="text-primary">Product Title</h4>
                <p id="productDescription" class="text-muted"></p>
                <p>
                  <strong class="text-dark">Price:</strong>
                  <span id="productPrice" class="text-success">$99.99</span>
                </p>
                <p>
                  <strong class="text-dark">Category:</strong>
                  <span id="productCategory">Electronics</span>
                </p>
                <hr />
                <p><strong></strong></p>
                <ul id="productDetails" class="list-unstyled">
                  <li>Detail 1</li>
                  <li>Detail 2</li>
                  <li>Detail 3</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- Modal for Login -->
    <div
      class="modal fade"
      id="authModal"
      tabindex="-1"
      aria-labelledby="authModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="authModalLabel">Log In</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <!-- Form content for login/signup -->
            <div class="mb-3">
              <label for="email" class="form-label">Email address</label>
              <input
                type="email"
                class="form-control"
                id="email"
                placeholder="Enter your email"
              />
            </div>
            <div class="mb-3">
              <label for="password" class="form-label">Password</label>
              <input
                type="password"
                class="form-control"
                id="password"
                placeholder="Enter your password"
              />
            </div>
            <div class="d-flex justify-content-between">
              <button type="submit" class="btn btn-button" id="loginButton">
                Log In
              </button>
            </div>
            <a href="../frontend/Html/forgot.html" class="d-block mt-3"
              >Forgot password?</a
            >
          </div>
        </div>
      </div>
    </div>
    <!-- Login Modal -->
    <div
      class="modal fade"
      id="authModal"
      tabindex="-1"
      aria-labelledby="authModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="authModalLabel">Log In</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <!-- Login Form -->
            <form id="loginForm">
              <div class="mb-3">
                <label for="email" class="form-label">Email address</label>
                <input
                  type="email"
                  class="form-control"
                  id="email"
                  placeholder="Enter your email"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="password" class="form-label">Password</label>
                <input
                  type="password"
                  class="form-control"
                  id="password"
                  placeholder="Enter your password"
                  required
                />
              </div>
              <div class="d-flex justify-content-between">
                <button type="submit" class="btn btn-button" id="loginButton">
                  Log In
                </button>
              </div>
            </form>
            <a href="../frontend/Html/forgot.html">Forgot password?</a>
          </div>
        </div>
      </div>
    </div>

    <!-- Sign Up Modal -->
    <div
      class="modal fade"
      id="authModal1"
      tabindex="-1"
      aria-labelledby="authModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="authModalLabel">Sign Up</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <!-- Form content for signup -->
            <div class="mb-3">
              <label for="signupFullName" class="form-label">Full Name</label>
              <input
                type="text"
                class="form-control"
                id="signupFullName"
                placeholder="eg. Mike"
              />
            </div>
            <div class="mb-3">
              <label for="signupEmail" class="form-label">Email address</label>
              <input
                type="email"
                class="form-control"
                id="signupEmail"
                placeholder="eg. mikeoxlong69@gmail.com"
              />
            </div>
            <div class="mb-3">
              <label for="signupPassword" class="form-label">Password</label>
              <input
                type="password"
                class="form-control"
                id="signupPassword"
                placeholder="Enter your password"
              />
            </div>
            <div class="mb-3">
              <label for="signupConfirmPassword" class="form-label"
                >Confirm Password</label
              >
              <input
                type="password"
                class="form-control"
                id="signupConfirmPassword"
                placeholder="Confirm your password"
              />
            </div>
            <div class="d-flex justify-content-between">
              <button class="btn btn-button" id="signupSubmitButton">
                Submit
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Cookie Modal -->
    <div id="cookieModal" class="cookie-modal">
      <div class="cookie-content">
        <svg
          xml:space="preserve"
          viewBox="0 0 122.88 122.25"
          y="0px"
          x="0px"
          id="cookieSvg"
          version="1.1"
        >
          <g>
            <path
              d="M101.77,49.38c2.09,3.1,4.37,5.11,6.86,5.78c2.45,0.66,5.32,0.06,8.7-2.01c1.36-0.84,3.14-0.41,3.97,0.95 c0.28,0.46,0.42,0.96,0.43,1.47c0.13,1.4,0.21,2.82,0.24,4.26c0.03,1.46,0.02,2.91-0.05,4.35h0v0c0,0.13-0.01,0.26-0.03,0.38 c-0.91,16.72-8.47,31.51-20,41.93c-11.55,10.44-27.06,16.49-43.82,15.69v0.01h0c-0.13,0-0.26-0.01-0.38-0.03 c-16.72-0.91-31.51-8.47-41.93-20C5.31,90.61-0.73,75.1,0.07,58.34H0.07v0c0-0.13,0.01-0.26,0.03-0.38 C1,41.22,8.81,26.35,20.57,15.87C32.34,5.37,48.09-0.73,64.85,0.07V0.07h0c1.6,0,2.89,1.29,2.89,2.89c0,0.4-0.08,0.78-0.23,1.12 c-1.17,3.81-1.25,7.34-0.27,10.14c0.89,2.54,2.7,4.51,5.41,5.52c1.44,0.54,2.2,2.1,1.74,3.55l0.01,0 c-1.83,5.89-1.87,11.08-0.52,15.26c0.82,2.53,2.14,4.69,3.88,6.4c1.74,1.72,3.9,3,6.39,3.78c4.04,1.26,8.94,1.18,14.31-0.55 C99.73,47.78,101.08,48.3,101.77,49.38L101.77,49.38z M59.28,57.86c2.77,0,5.01,2.24,5.01,5.01c0,2.77-2.24,5.01-5.01,5.01 c-2.77,0-5.01-2.24-5.01-5.01C54.27,60.1,56.52,57.86,59.28,57.86L59.28,57.86z M37.56,78.49c3.37,0,6.11,2.73,6.11,6.11 s-2.73,6.11-6.11,6.11s-6.11-2.73-6.11-6.11S34.18,78.49,37.56,78.49L37.56,78.49z M50.72,31.75c2.65,0,4.79,2.14,4.79,4.79 c0,2.65-2.14,4.79-4.79,4.79c-2.65,0-4.79-2.14-4.79-4.79C45.93,33.89,48.08,31.75,50.72,31.75L50.72,31.75z M119.3,32.4 c1.98,0,3.58,1.6,3.58,3.58c0,1.98-1.6,3.58-3.58,3.58s-3.58-1.6-3.58-3.58C115.71,34.01,117.32,32.4,119.3,32.4L119.3,32.4z M93.62,22.91c2.98,0,5.39,2.41,5.39,5.39c0,2.98-2.41,5.39-5.39,5.39c-2.98,0-5.39-2.41-5.39-5.39 C88.23,25.33,90.64,22.91,93.62,22.91L93.62,22.91z M97.79,0.59c3.19,0,5.78,2.59,5.78,5.78c0,3.19-2.59,5.78-5.78,5.78 c-3.19,0-5.78-2.59-5.78-5.78C92.02,3.17,94.6,0.59,97.79,0.59L97.79,0.59z M76.73,80.63c4.43,0,8.03,3.59,8.03,8.03 c0,4.43-3.59,8.03-8.03,8.03s-8.03-3.59-8.03-8.03C68.7,84.22,72.29,80.63,76.73,80.63L76.73,80.63z M31.91,46.78 c4.8,0,8.69,3.89,8.69,8.69c0,4.8-3.89,8.69-8.8,8.69s-8.69-3.89-8.69-8.69C23.22,50.68,27.11,46.78,31.91,46.78L31.91,46.78z M107.13,60.74c-3.39-0.91-6.35-3.14-8.95-6.48c-5.78,1.52-11.16,1.41-15.76-0.02c-3.37-1.05-6.32-2.81-8.71-5.18 c-2.39-2.37-4.21-5.32-5.32-8.75c-1.51-4.66-1.69-10.2-0.18-16.32c-3.1-1.8-5.25-4.53-6.42-7.88c-1.06-3.05-1.28-6.59-0.61-10.35 C47.27,5.95,34.3,11.36,24.41,20.18C13.74,29.69,6.66,43.15,5.84,58.29l0,0.05v0h0l-0.01,0.13v0C5.07,73.72,10.55,87.82,20.02,98.3 c9.44,10.44,22.84,17.29,38,18.1l0.05,0h0v0l0.13,0.01h0c15.24,0.77,29.35-4.71,39.83-14.19c10.44-9.44,17.29-22.84,18.1-38l0-0.05 v0h0l0.01-0.13v0c0.07-1.34,0.09-2.64,0.06-3.91C112.98,61.34,109.96,61.51,107.13,60.74L107.13,60.74z M116.15,64.04L116.15,64.04 L116.15,64.04L116.15,64.04z M58.21,116.42L58.21,116.42L58.21,116.42L58.21,116.42z"
            ></path>
          </g>
        </svg>
        <p class="cookieHeading">We use cookies.</p>
        <p class="cookieDescription">
          We use cookies to ensure that we give you the best experience on our
          website. <br /><a href="./Html/cookie-policy.html"
            >Read cookies policies</a
          >.
        </p>
        <div class="buttonContainer">
          <button class="acceptButton">Allow</button>
          <button class="declineButton">Decline</button>
        </div>
      </div>
    </div>

    <!-- Carousel Section -->
    <div
      id="productCarousel"
      class="carousel slide"
      data-bs-ride="carousel"
      data-bs-interval="3500"
    >
      <div class="carousel-indicators">
        <button
          type="button"
          data-bs-target="#productCarousel"
          data-bs-slide-to="0"
          class="active"
          aria-current="true"
          aria-label="Slide 1"
        ></button>
        <button
          type="button"
          data-bs-target="#productCarousel"
          data-bs-slide-to="1"
          aria-label="Slide 2"
        ></button>
        <button
          type="button"
          data-bs-target="#productCarousel"
          data-bs-slide-to="2"
          aria-label="Slide 3"
        ></button>
      </div>
      <div class="carousel-inner">
        <!-- Only one "active" class here -->
        <div class="carousel-item active">
          <img
            src="https://github.com/Urswin-Faro/Arive_assets/blob/main/Assets/imgs/welcom.jpg?raw=true"
            class="d-block w-100"
            style="height: 500px; object-fit: cover"
            alt="Laptops"
          />
          <div class="carousel-caption d-none d-md-block"></div>
        </div>
        <div class="carousel-item">
          <a href="https://discord.gg/S4BRRCy4">
            <img
              src="https://github.com/Urswin-Faro/Arive_assets/blob/main/Assets/imgs/discord%20(2).jpg?raw=true"
              class="d-block w-100"
              style="height: 500px; object-fit: cover"
              alt="Laptops"
          /></a>
          <div class="carousel-caption d-none d-md-block"></div>
        </div>
        <div class="carousel-item">
          <img
            src="https://github.com/Urswin-Faro/Arive_assets/blob/main/Assets/imgs/Banner.jpg?raw=true"
            class="d-block w-100"
            style="height: 500px; object-fit: cover"
            alt="Laptops"
          />
          <div class="carousel-caption d-none d-md-block"></div>
        </div>
      </div>
      <button
        class="carousel-control-prev"
        type="button"
        data-bs-target="#productCarousel"
        data-bs-slide="prev"
      >
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
      </button>
      <button
        class="carousel-control-next"
        type="button"
        data-bs-target="#productCarousel"
        data-bs-slide="next"
      >
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
      </button>
    </div>

    <!-- Cards Section -->
    <section class="product-section">
      <div class="container">
        <div class="row justify-content-center">
          <div class="col-md-3 d-flex">
            <div class="card">
              <img
                src="https://github.com/Urswin-Faro/Arive_assets/blob/main/Assets/products/laptops/Laptop%20Home.jpg?raw=true"
                class="card-img-top"
                alt="Laptops"
              />
              <div class="card-body text-center">
                <h5 class="card-title">Laptops</h5>
                <p class="card-text">Discover high-performance laptops.</p>
                <a href="./Html/laptop.html" class="btn btn-button">Shop Now</a>
              </div>
            </div>
          </div>
          <div class="col-md-3 d-flex">
            <div class="card">
              <img
                src="https://github.com/Urswin-Faro/Arive_assets/blob/main/Assets/products/desktops/home%20desktop.jpg?raw=true"
                class="card-img-top"
                alt="Desktops"
              />
              <div class="card-body text-center">
                <h5 class="card-title">Monitors</h5>
                <p class="card-text">High-resolution monitors.</p>
                <a href="./Html/monitors.html" class="btn btn-button"
                  >Shop Now</a
                >
              </div>
            </div>
          </div>
          <div class="col-md-3 d-flex">
            <div class="card">
              <img
                src="https://github.com/Urswin-Faro/Arive_assets/blob/main/Assets/products/accessories/home%20page%20accessories.jpg?raw=true"
                class="card-img-top"
                alt="Accessories"
              />
              <div class="card-body text-center">
                <h5 class="card-title">Accessories</h5>
                <p class="card-text">Upgrade your setup with accessories.</p>
                <a href="./Html/accessories.html" class="btn btn-button"
                  >Shop Now</a
                >
              </div>
            </div>
          </div>
          <div class="col-md-3 d-flex">
            <div class="card">
              <img
                src="https://github.com/Urswin-Faro/Arive_assets/blob/main/Assets/products/PC%20towers/home%20pc%20tower.jpg?raw=true"
                class="card-img-top"
                alt="Monitors"
              />
              <div class="card-body text-center">
                <h5 class="card-title">Desktops</h5>
                <p class="card-text">Powerful and reliable desktops.</p>
                <a href="./Html/PcTowers.html" class="btn btn-button"
                  >Shop Now</a
                >
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <script>
      // Ensure SweetAlert is included
      if (typeof Swal === "undefined") {
        let script = document.createElement("script");
        script.src = "https://cdn.jsdelivr.net/npm/sweetalert2@11";
        document.head.appendChild(script);
      }

      // the close button on cart
      function closeCart() {
        document.querySelector(".cart-dropdown").style.display = "none";
      }

      document.addEventListener("DOMContentLoaded", () => {
        const cookieModal = document.getElementById("cookieModal");
        const acceptButton = document.querySelector(".acceptButton");
        const declineButton = document.querySelector(".declineButton");

        // Only show the modal if the user hasn't made a cookie decision yet
        if (localStorage.getItem("cookiesAccepted") === null) {
          cookieModal.style.display = "flex";
        } else {
          cookieModal.style.display = "none";
        }

        // Accept cookies: set localStorage and hide modal
        acceptButton.addEventListener("click", () => {
          localStorage.setItem("cookiesAccepted", "true");
          cookieModal.style.display = "none";
        });

        // Decline cookies: if you want to hide the modal on decline too, store the decision and hide it
        declineButton.addEventListener("click", () => {
          localStorage.setItem("cookiesAccepted", "false");
          cookieModal.style.display = "none";
        });
      });

      // Search Function
      document.addEventListener("DOMContentLoaded", function () {
        const searchForm = document.getElementById("searchForm");
        const searchInput = document.getElementById("searchInput");

        // Handle search form submission
        searchForm.addEventListener("submit", function (event) {
          event.preventDefault();
          const query = searchInput.value.trim();

          if (query) {
            searchProducts(query);
          } else {
            Swal.fire({
              icon: "warning",
              title: "Missing Search Term",
              text: "Please enter a search term before searching.",
            });
          }
        });

        // Function to search products
        function searchProducts(query) {
          fetch(`http://localhost:3030/products/search?query=${query}`)
            .then((response) => response.json())
            .then((data) => {
              if (data && data.length > 0) {
                displaySearchResults(data);
              } else {
                Swal.fire({
                  icon: "info",
                  title: "No Products Found",
                  text: "Try a different search term.",
                });
              }
            })
            .catch((error) => {
              console.error("Error searching products:", error);
              Swal.fire({
                icon: "error",
                title: "Search Error",
                text: "An error occurred while searching. Please try again later.",
              });
            });
        }

        // Function to display search results in the modal
        function displaySearchResults(products) {
          const modal = new bootstrap.Modal(
            document.getElementById("searchResultsModal")
          );
          const container = document.getElementById("searchResultsContainer");

          container.innerHTML = ""; // Clear previous results

          products.forEach((product) => {
            const productCard = document.createElement("div");
            productCard.classList.add("col-md-4", "mb-3");

            productCard.innerHTML = `
                <div class="card">
                    <img src="${product.image}" class="card-img-top" alt="${product.Name}">
                    <div class="card-body">
                        <h5 class="card-title">${product.Name}</h5>
                        <p><strong>Price: </strong>R${product.Price}</p>
                        <button class='product-btn' onclick="viewMore(${product.product_id})">View More</button>
                    </div>
                </div>
            `;
            container.appendChild(productCard);
          });

          modal.show(); // Show the modal
        }
      });

      document.addEventListener("DOMContentLoaded", function () {
        const cartItemsContainer = document.getElementById("cart-items");
        const subtotalEl = document.getElementById("subtotal");
        const totalEl = document.getElementById("total");
        const cartDropdown = document.querySelector(".cart-dropdown");
        const cartToggleBtn = document.getElementById("cart-toggle");

        const userId = 2; // Replace with the actual authenticated user ID

        // Fetch cart items
        async function fetchCartItems() {
          try {
            console.log("🔄 Fetching cart items...");
            const response = await fetch(`http://localhost:3030/cart/2`);
            let cart = await response.json();

            console.log("📦 Cart data received:", cart);
            if (cart.error) cart = []; // Handle empty cart response
            updateCartDisplay(cart);
          } catch (error) {
            console.error("🚨 Error fetching cart:", error);
            Swal.fire({
              icon: "error",
              title: "Oops...",
              text: "An error occurred while fetching the cart!",
            });
          }
        }
        // fetchCartItems()

        // Update Cart Display
        function updateCartDisplay(cart) {
          const cartItemsContainer = document.getElementById("cart-items");
          const subtotalEl = document.getElementById("subtotal");
          const totalEl = document.getElementById("total");

          if (!cartItemsContainer || !subtotalEl || !totalEl) {
            console.error("❌ Cart elements not found in the DOM.");
            return;
          }

          cartItemsContainer.innerHTML = "";
          let subtotal = 0;

          if (!Array.isArray(cart) || cart.length === 0) {
            cartItemsContainer.innerHTML =
              "<p class='empty-cart'>Your cart is empty</p>";
            subtotalEl.textContent = "R 0.00";
            totalEl.textContent = "R 0.00";
            return;
          }

          console.log("📦 Cart Data Received:", cart);

          cart.forEach((item) => {
            if (!item.product_id || !item.Name || item.Price === undefined) {
              console.error("⚠️ Invalid cart item:", item);
              return;
            }

            const price = item.Price ? item.Price : 0;
            subtotal += price * item.quantity;

            const cartItem = document.createElement("div");
            cartItem.classList.add("cart-item");

            cartItem.innerHTML = `
            <img class="cart-img" src="${item.image}"  "alt="${item.Name}">
            <div class="item-details">
                <h3>${item.Name}</h3>
                <p class="item-price">R ${item.Price * item.quantity}</p>
            </div>
            <div class="quantity-controls">
                <button class="quantity-btn" onclick="changeQuantity(${
                  item.cart_id
                }, -1)">-</button>
                <span>${item.quantity}</span>
                <button class="quantity-btn" onclick="changeQuantity(${
                  item.cart_id
                }, 1)">+</button>
            </div>
            <button class="remove-btn" onclick="removeFromCart(${
              item.cart_id
            })"><svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="25" height="25" viewBox="0,0,256,256">
<g fill="#f90202" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><g transform="scale(10.66667,10.66667)"><path d="M10,2l-1,1h-5v2h16v-2h-5l-1,-1zM5,7v13c0,1.1 0.9,2 2,2h10c1.1,0 2,-0.9 2,-2v-13zM8,9h2v11h-2zM14,9h2v11h-2z"></path></g></g>
</svg></button>

        `;

            cartItemsContainer.appendChild(cartItem);
          });

          subtotalEl.textContent = `R ${subtotal.toFixed(2)}`;
          const tax = subtotal * 0.15;
          totalEl.textContent = `R ${(subtotal + tax).toFixed(2)}`;
        }

        // Add item to cart
        document.body.addEventListener("click", async function (event) {
          if (event.target.closest(".add-to-cart")) {
            console.log("🛒 Add to Cart clicked!");

            const button = event.target.closest(".add-to-cart");
            const productId = button.getAttribute("data-product-id");
            const quantity = 1;

            try {
              const response = await fetch("http://localhost:3030/cart/add", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ userId, productId, quantity }),
              });

              const result = await response.json();
              if (result.success) {
                Swal.fire({
                  icon: "success",
                  title: "Success!",
                  text: "Product added to cart!",
                });
                fetchCartItems(); // Refresh cart display
              } else {
                Swal.fire({
                  icon: "error",
                  title: "Failed",
                  text: "Failed to add product to cart.",
                });
              }
            } catch (error) {
              console.error("🚨 Error adding to cart:", error);
              Swal.fire({
                icon: "error",
                title: "Error",
                text: "An error occurred while adding to cart.",
              });
            }
          }
        });

        // Change quantity (increase/decrease)
        async function changeQuantity(cartId, change) {
          try {
            console.log(
              `🔄 Changing quantity for cartId ${cartId}, Change: ${change}`
            );
            const endpoint =
              change > 0
                ? `http://localhost:3030/cart/update/increase/${cartId}`
                : `http://localhost:3030/cart/update/decrease/${cartId}`;

            const response = await fetch(endpoint, { method: "PUT" });
            const result = await response.json();

            if (result.success) {
              Swal.fire({
                icon: "success",
                title: "Success",
                text: "Quantity updated!",
              });
              fetchCartItems(); // Refresh cart
            } else {
              Swal.fire({
                icon: "error",
                title: "Failed",
                text: "Failed to update quantity.",
              });
            }
          } catch (error) {
            console.error("🚨 Error updating cart:", error);
            Swal.fire({
              icon: "error",
              title: "Error",
              text: "An error occurred while updating the quantity.",
            });
          }
        }

        // Remove item from cart
        async function removeFromCart(cartId) {
          try {
            console.log(`🗑️ Removing item with cartId: ${cartId}`);
            const response = await fetch(
              `http://localhost:3030/cart/delete/${cartId}`,
              { method: "DELETE" }
            );
            const result = await response.json();

            if (result.success) {
              Swal.fire({
                icon: "success",
                title: "Success",
                text: "Item removed from cart!",
              });
              fetchCartItems(); // Refresh cart display
            } else {
              Swal.fire({
                icon: "error",
                title: "Failed",
                text: "Failed to remove item.",
              });
            }
          } catch (error) {
            console.error("🚨 Error removing item:", error);
            Swal.fire({
              icon: "error",
              title: "Error",
              text: "An error occurred while removing the item.",
            });
          }
        }

        // Toggle cart dropdown visibility
        cartToggleBtn.addEventListener("click", function () {
          cartDropdown.style.display =
            cartDropdown.style.display === "none" ||
            cartDropdown.style.display === ""
              ? "block"
              : "none";
        });

        fetchCartItems();

        // Expose functions globally
        window.changeQuantity = changeQuantity;
        window.removeFromCart = removeFromCart;
      });

      document.addEventListener("DOMContentLoaded", function () {
        const signupSubmitButton =
          document.getElementById("signupSubmitButton");

        signupSubmitButton.addEventListener("click", function () {
          const fullName = document.getElementById("signupFullName").value;
          const email = document.getElementById("signupEmail").value;
          const password = document.getElementById("signupPassword").value;
          const confirmPassword = document.getElementById(
            "signupConfirmPassword"
          ).value;

          // Validation
          if (!fullName || !email || !password || !confirmPassword) {
            Swal.fire({
              icon: "error",
              title: "Oops...",
              text: "Please fill in all fields!",
            });
            return;
          }

          if (password !== confirmPassword) {
            Swal.fire({
              icon: "error",
              title: "Oops...",
              text: "Passwords do not match!",
            });
            return;
          }

          const userData = {
            full_name: fullName,
            email: email,
            password: password,
          };

          // Send data to the backend
          fetch("http://127.0.0.1:3030/api/auth/signup", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(userData),
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                // Show success message
                // Show error message based on the response
                Swal.fire({
                  icon: "error",
                  title: "Signup Failed",
                  text: data.message || "An error occurred during signup.",
                });
              } else {
                Swal.fire({
                  icon: "success",
                  title: "Signup Successful!",
                  text: "You have successfully signed up.",
                }).then(() => {
                  // Optionally, redirect the user or close the modal
                  window.location.href = "./index.html"; // Redirect if needed
                });
              }
            })
            .catch((error) => {
              console.error("Error signing up:", error);
              Swal.fire({
                icon: "error",
                title: "Oops...",
                text: "An error occurred while signing up. Please try again.",
              });
            });
        });
      });

      document.addEventListener("DOMContentLoaded", function () {
        const loginButton = document.getElementById("loginButton");
        const userDisplay = document.querySelector(".userName"); // Select the <p> tag
        const logoutButton = document.getElementById("logoutButton"); // Logout button

        loginButton.addEventListener("click", async function (event) {
          event.preventDefault();

          const email = document.getElementById("email").value;
          const password = document.getElementById("password").value;

          if (!email || !password) {
            alert("Please enter both email and password.");
            return;
          }

          try {
            const response = await fetch("http://127.0.0.1:3030/users/login", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ email, password }),
              credentials: "include", // Important to send cookies
            });

            const data = await response.json();

            if (data.success) {
              localStorage.setItem("accessToken", data.accessToken);
              const name = data.name.split(" ")[0]; // Get first name
              localStorage.setItem("user", name);

              // Display the username
              userDisplay.innerText = `Hi! ${name}!`;
              userDisplay.style.display = "block";

              console.log("Logged in user:", name);

              Swal.fire({
                icon: "success",
                title: "Login Successful!",
                text: "You are now logged in.",
              }).then(() => {
                if (name === "admin") {
                  console.log("Admin logged in");
                  window.location.href = "./Html/admin.html";
                } else {
                  window.location.href = "./index.html"; // Reload page
                }
              });
            } else {
              Swal.fire({
                icon: "error",
                title: "Login Failed",
                text: data.message,
              });
            }
          } catch (error) {
            console.error("Login error:", error);
          }
        });

        // Check if user is logged in
        if (localStorage.getItem("accessToken")) {
          document.querySelectorAll("[btn]").forEach((value) => {
            value.style.display = "none"; // Hide login button
          });

          const name = localStorage.getItem("user");
          if (name) {
            userDisplay.innerText = ` Hi!, ${name}`;
            userDisplay.style.display = "block"; // Show username
            userDisplay.style.color = "white"; // Show username in white
            logoutButton.style.display = "block"; // Show logout button
          }
        }

        // Logout functionality
        logoutButton.addEventListener("click", function () {
          localStorage.removeItem("accessToken");
          localStorage.removeItem("user");
          Swal.fire({
            icon: "info",
            title: "Logged Out",
            text: "You have been logged out successfully.",
          }).then(() => {
            window.location.href = "./index.html";
          });
        });
      });

      async function viewMore(productId) {
        try {
          const response = await fetch(
            `http://localhost:3030/products/${productId}`
          );
          const product = await response.json();
          console.log(product);

          // Populate modal fields
          document.getElementById("productTitle").textContent = product.Name;
          document.getElementById(
            "productPrice"
          ).textContent = `R${product.Price}`;
          document.getElementById("productCategory").textContent =
            product.Category;

          // Update product image
          const productImage = document.querySelector("#productModal img");
          productImage.src = product.image;
          productImage.alt = product.title;

          // Update details list
          const detailsList = document.getElementById("productDetails");
          detailsList.innerHTML = `
                 <li><strong>Description:</strong> ${product.Description}</li>
                 <br>
                 <button type="button" class="button add-to-cart" data-product-id="${product.product_id}">
      <span class="button__text">Add to Cart</span>
      <span class="button__icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24" stroke-width="2" stroke-linejoin="round" stroke-linecap="round" stroke="currentColor" height="24" fill="none" class="svg"><line y2="19" y1="5" x2="12" x1="12"></line><line y2="12" y1="12" x2="19" x1="5"></line></svg></span>
    </button>    
            `;

          // Show the modal
          const productModal = new bootstrap.Modal(
            document.getElementById("productModal")
          );
          productModal.show();
        } catch (error) {
          console.error("Error fetching product details:", error);
          Swal.fire({
            icon: "error",
            title: "Error",
            text: "An error occurred while fetching the product details.",
          });
        }
      }
    </script>

    <!-- Footer -->
    <footer class="bg-dark text-white py-4">
      <div class="container">
        <div class="row">
          <div class="col-md-4">
            <h5>Contact Us</h5>
            <p>123 Business St, Suite 456</p>
            <p>City, Country, 12345</p>
            <p>Email: admin@arize.co.za</p>
          </div>
          <div class="col-md-4">
            <h5>Quick Links</h5>
            <ul class="list-unstyled">
              <li><a href="./index.html" class="text-white">Home</a></li>
              <li>
                <a href="./Html/products.html" class="text-white">Products</a>
              </li>
              <li>
                <a href="./Html/about.html" class="text-white">About Us</a>
              </li>
            </ul>
          </div>
          <div class="col-md-4">
            <h5>Follow Us</h5>
            <ul class="list-unstyled">
              <li>
                <a href="https://discord.gg/S4BRRCy4" class="text-white"
                  ><i class="fab fa-discord"></i>Discord</a
                >
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="text-center py-3">
        <p>&copy; 2025 Your Company Name. All rights reserved.</p>
      </div>
    </footer>
  </body>
</html>
